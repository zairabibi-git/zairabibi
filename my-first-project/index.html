<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>My First Project &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://zairabibi.io/favicon.ico" />
    <link rel="canonical" href="https://zairabibi.io/my-first-project/" />

     <meta name="description" content="64-bit OS Our assignment was to build our own 64-bit operating system. Videos for guidance were prvided by the profesor and I followed them to create my OS. The" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://zairabibi.io/postphoto1.jpg"/>
    
 
    <meta name="twitter:title" content="My First Project"/>
    <meta name="twitter:description" content="64-bit OS Our assignment was to build our own 64-bit operating system. Videos for guidance were prvided by the profesor and I followed them to create my OS. The"/>
    <meta name="twitter:url" content="https://zairabibi.io/my-first-project/" />
    <meta name="twitter:site" content="@"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="My First Project &middot; CAO Assignment" />
    <meta property="og:url" content="https://zairabibi.io/my-first-project/" />
    <meta property="article:publisher" content="https://www.facebook.com/zaira.bibi.56" />

    <meta property="og:type" content="article" />
    <meta property="og:description" content="64-bit OS Our assignment was to build our own 64-bit operating system. Videos for guidance were prvided by the profesor and I followed them to create my OS. The" />

    <meta property="article:published_time" content="2021-04-19T13:05:38&#43;05:00" />
    

    <meta property="og:image" content="https://zairabibi.io/postphoto1.jpg"/>


    <meta name="generator" content="Hugo 0.82.0" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://zairabibi.io/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://zairabibi.io/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    

     

</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/my-profile">Profile</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/my-first-project">Projects</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://google.com/">Google</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    <a class="social-link social-link-fb" href="https://www.facebook.com/zaira.bibi.56" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg></a>

                    

                    <a class="social-link" href="https://github.com/zairabibi" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2021-04-19">19 April 2021</time>
        </section>
        <h1 class="post-full-title">My First Project</h1>
    </header>
    
    <figure class="post-full-image" style="background-image: url(https://zairabibi.io/postphoto1.jpg)">
    </figure>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        <h1 id="64-bit-os">64-bit OS</h1>
<p>Our assignment was to build our own 64-bit operating system. Videos for guidance were prvided by the profesor and I followed them to create my OS. The code is similar to the video code, however, I have added comments and descriptions where necessary to show that I understood the code fully and completely.</p>
<h5 id="git-repository">Git Repository</h5>
<p><a href="https://github.com/zairabibi-git/myOS"><em>zairabibi-git/myOS</em></a></p>
<h5 id="output-image">Output Image</h5>
<p>Onto the description:</p>
<h5 id="softwares-used">Softwares Used</h5>
<ol>
<li>Visual Studio Code as a text editor</li>
<li>Docker to build container image</li>
<li>Qemu to emulate or OS so we don&rsquo;t have to boot it using USB</li>
</ol>
<h5 id="building-a-64-bit-os">Building a 64-bit OS</h5>
<p>Our first step in creating a 64-bit OS is to understand and create a 32-bit OS. 32-bit one is relatively simple so it is not described. We will start with 64-bit OS directly. It contains the following files and folders:</p>
<ol>
<li>
<p><code>buildenv</code></p>
<p>It contains a <a href="https://github.com/zairabibi-git/myOS/blob/main/buildenv/Dockerfile"><em>Dockerfile</em></a> which describes all the sets we need to create our build environment image. Our image is based on a pre-made image which holds all the gcc image compilation tools we&rsquo;ll need.</p>
</li>
<li>
<p><code>src\imp\x86_64\boot</code></p>
<p>The x86_64 folder gives us the entry point into our operating system. The boot folder contains:</p>
<ol>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/src/impl/x86_64/boot/header.asm"><em>header.asm</em></a></p>
</li>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/src/impl/x86_64/boot/main.asm"><em>main.asm</em></a></p>
</li>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/src/impl/x86_64/boot/main64.asm"><em>main64.asm</em></a></p>
</li>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/src/impl/kernel/main.c"><em>main.c</em></a>: In the <code>src\imp\kernel</code> directory.</p>
</li>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/src/impl/x86_64/print.c"><em>print.c</em></a>: Inside the <code>src\imp\x86_64</code> directory.</p>
</li>
</ol>
</li>
<li>
<p><code>src\interface</code></p>
<p>It will have a <a href="https://github.com/zairabibi-git/myOS/blob/main/src/interface/print.h"><em>print.h</em></a> file that provides us with the printing interface.</p>
</li>
<li>
<p><code>targets/x86_64</code>
Here we will hold all the files needed for building x86, and it might be expanded to other systems.</p>
<ol>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/targets/x86_64/linker.ld"><em>linker.ld</em></a>: It describes how to link our operating system together. We must specify the entry point in this file.</p>
</li>
<li>
<p><code>iso</code> folder: This will contain a grub configuration (<a href="https://github.com/zairabibi-git/myOS/blob/main/targets/x86_64/iso/boot/grub/grub.cfg"><em>grub.cfg</em></a>) file inside <code>boot/grub</code>.</p>
</li>
</ol>
</li>
<li>
<p><a href="https://github.com/zairabibi-git/myOS/blob/main/Makefile"><em>Makefile</em></a>: Make is good tool to organize all the build commands and making sure that only those file which have been modified get rebuild.</p>
</li>
</ol>
<h5 id="description">Description</h5>
<h6 id="mainasm">main.asm</h6>
<ol>
<li>
<p>We first set up a <strong>stack</strong> which is a region of computer memory. It handles function calls and all the data. It allows us to link with C code so that we can make our priting function.</p>
</li>
<li>
<p>We then switch our kernel from 32-bit to <strong>64-bit</strong> mode. To do this, we have to switch our CPU into long mode. This is done in the following sections</p>
<ol>
<li>
<p><strong>Check Multiboot:</strong></p>
<p>This confirms that we have been loaded into a multiboot2 boot loader. A magic value is stored into <code>eax</code> register by any compliant boot loader, so we will check if <code>eax</code> hold that magic value. If the values don&rsquo;t match on comparing, then there is no multiboot so we will print an error message.</p>
<p>Otherwise, we will return from the sub routine.</p>
</li>
<li>
<p><strong>Check for CPU ID:</strong></p>
<p>CPU ID is a CPU instruction which provides information about the CPU. We need to flip the ID bit of flag register, and if we&rsquo;re successful then the CPU supports CPU ID.</p>
<p>This is done using stack so that all flags retain their original data after the subroutine ends. We store the flag data into <code>eax</code> and make a copy in  <code>ecx</code>. After flipping the <code>bit 21</code> of <code>eax</code>, which is the ID bit, we compare it with the copy stored in <code>ecx</code>. If they match, then we know that the CPU didnot allow us to flip that bit, which means that CPU ID is not available. In this case we print an error message.</p>
<p>Otherwise, we will return from the sub routine.</p>
</li>
<li>
<p><strong>Check for Long Mode Support:</strong></p>
<p>We need to first confirm if the CPU ID supports the extended processor information. For this, we will run the <em>cpuid</em> instruction which will take <code>eax</code> as an argument, and store some value back into <code>eax</code>. If this value is greater than the value previously stored in <code>eax</code>, then the CPU supports extended processor information.</p>
<p>Otherwise, extended processor information is not supported, and in turn long-mode is <strong>not</strong> supported and we will jump to <code>.no_long_mode</code> label.</p>
<ul>
<li><strong>If Extended Processor Info is Supported</strong>:
We will again run <em>cpuid</em> instruction after storing a value in <code>eax</code>. This time, a value will be written in <code>edx</code> register. If <em>lm</em> bit (<code>bit 29</code>) is set, then long mode is supported and we can return succesfully from the sub routine. Otherwise we will jump to <code>.no_long_mode</code> label.</li>
</ul>
</li>
</ol>
<p>We&rsquo;ve checked for all the three things. but we cannot enter into long mode just yet. To enter long mode, we need to set up <a href="https://www.geeksforgeeks.org/paging-in-operating-system/"><em>Paging</em></a>. (In simple words, Paging allows us to map virtual addresses to physical addresses). This will be done by:</p>
<ol>
<li>
<p><strong>Setting up Page Tables:</strong>
We have four types of page tables, namely L4, L3, L2, L1, so we will reserve memory for page tables (each page table is <code>4KB</code>). Doing <em>Identity Mapping</em>, i.e. mapping physical address to the exact same virtual address so that our instructions are executed perfectly since CPU will read the instructions and treat the address as virtual address. So we will add one entry to the <em>L4</em> table, which will point to the <em>L3</em> table, and similarly there will be one entry in the <em>L3</em> table which will point to the <em>L2</em> table. Enabling the <code>huge table</code> flag in <em>L2</em>, we can point directly to the physical memory and allocate a huge page.</p>
<ul>
<li><strong>Filling up all 512 entries of L2</strong>
Each entry is <code>2MB</code> each, so a total of 1 <code>GB</code> of physical memory will be identity mapped. In a loop, we will map a <code>2MB</code> page in each iteration. The loop will run 512 times to ensure each entry has been mapped.</li>
</ul>
<p>Once this is done, we can return from the sub routine.</p>
</li>
<li>
<p><strong>Enabling Paging:</strong></p>
<p>We will pass page table location to the CPU. This location will be in the <code>cr3</code> register. We enable Physical Address Extension (by enabling <code>PAE</code> flag of <code>cr4</code>) as it is necessary for 64-bit paging.</p>
<ul>
<li>
<p><strong>Enable Long Mode:</strong> We will enable long-mode by using model specific registers.</p>
</li>
<li>
<p><strong>Enable Paging:</strong> Lastly we will enable paging by enabling <code>paging flag</code> in the <code>cr0</code> register.</p>
</li>
</ul>
</li>
</ol>
<p>We&rsquo;ll now enter 64-bit mode by describing a 64-bit <em>Global Descriptor Table</em>. After that, we will enable the <code>64-bit</code> flag, and have a pointer to the `<em>Global Descriptor Table</em>. Loading the Table and the code segment, we now have successfully entered 64-bit mode.</p>
</li>
</ol>
<p><strong>main64.asm</strong></p>
<p>We&rsquo;ll set our bits to 64 and have a global <code>long_mode_start</code> label. We&rsquo;ll then load <code>0</code> into many data segments so that our code is fully functional.</p>
<p><strong>main.c</strong></p>
<p>It will have a main function which calls all the other functions for printing the required text or pattern on the screen.</p>
<p><strong>print.c</strong></p>
<p>It gives the implementation of <em>print.h</em> file. The function to print <strong>NUST</strong> using <code>*</code> is called <code>printNUST()</code> and uses loops to create the following output:</p>
<p><img src="https://raw.githubusercontent.com/zairabibi-git/myOS/main/nust.JPG" alt="nust text" title="NUST printed using asteriks"></p>
    
        </div>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://zairabibi.io/my-profile.jpg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://zairabibi.io/">ZB</a></h4>
                <p>20 year old CS student.</p>
        </section>
      </section>
    </footer>
</article>
    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      

      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://zairabibi.io/my-profile/">
      <div class="post-card-image" style="background-image: url(https://zairabibi.io/my-profile.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://zairabibi.io/my-profile/">
          <header class="post-card-header">
              
              <h2 class="post-card-title">My Profile</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Introduction Hi! I&rsquo;m Zaira Bibi, born and raised in Abbottabad. I successfully completed my Matric and Intermedate Education from Army Burn Hall College for Girls, Abbottabad, and am currently doing my Bachelors in Computer Sciences from National University of Science and Technology (NUST), Islamabad. A brief account of my academic career is given below:
   Year Exam Name Marks Percentage     2017 Matric 1005/1050 95.7   2019 FSc 1019/1100 92. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://zairabibi.io/my-profile.jpg" alt="Author" />
          <span class="post-card-author"><a href="/">ZB</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://zairabibi.io/">
      
      <span></span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">My First Project</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=My%20First%20Project&amp;url=https%3a%2f%2fzairabibi.io%2fmy-first-project%2f"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fzairabibi.io%2fmy-first-project%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">EM</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        <a href="https://www.facebook.com/zaira.bibi.56" target="_blank" rel="noopener">Facebook</a>
        
        <a href="https://github.com/zairabibi" target="_blank" rel="noopener">Github</a>
        
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://zairabibi.io/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>



    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
